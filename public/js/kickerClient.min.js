!function(t,e,n){e[t]=n.call(e),"undefined"!=typeof module&&module.exports?module.exports=e[t]:"function"==typeof define&&define.amd&&define(function(){return e[t]})}("Primus",this,function(){var t,e=function n(t,e,r){function o(s,c){if(!e[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=e[s]={exports:{}};t[s][0].call(p.exports,function(e){var n=t[s][1][e];return o(n?n:e)},p,p.exports,n,t,e,r)}return e[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";e.exports=function(t,e){function n(t,n){if(e[t]){if("string"==typeof e[t]&&(e[t]=e[t].split(r)),"function"==typeof e[t])return e[t].call(n);for(var o,i,s=0;s<e[t].length;s++)i=e[t][s],o=typeof i,"function"===o?i.call(n):"string"===o&&"function"==typeof n[i]&&n[i]()}}var r=/[, ]+/;return e=e||{},t=t||[],"string"==typeof t&&(t=t.split(r)),function(){var e,r=this,o=0;if(null===r[t[0]])return!1;for(n("before",r);o<t.length;o++)e=t[o],r[e]&&("function"==typeof r[e].destroy&&r[e].destroy(),r[e]=null);return r.emit&&r.emit("destroy"),n("after",r),!0}}},{}],2:[function(t,e,n){"use strict";e.exports=function(){for(var t,e=this,n=0,r=arguments.length,o=new Array(r);r>n;n++)o[n]=arguments[n];return"function"!=typeof o[o.length-1]?function(){for(var t=0,n=arguments.length,r=new Array(n);n>t;t++)r[t]=arguments[t];return e.emit.apply(e,o.concat(r))}:(t=o.pop(),function(){for(var n=0,r=arguments.length,i=new Array(r+1);r>n;n++)i[n+1]=arguments[n];return i[0]=function(t,n){return t?e.emit("error",t):(i=void 0===n?i.slice(1):null===n?[]:n,void e.emit.apply(e,o.concat(i)))},t.apply(e,i),!0})}},{}],3:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){}o.prototype._events=void 0,o.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,r=new Array(n);n>e;e++)r[e]=this._events[t][e].fn;return r},o.prototype.emit=function(t,e,n,r,o,i){if(!this._events||!this._events[t])return!1;var s,c,a=this._events[t],u=arguments.length;if("function"==typeof a.fn){switch(a.once&&this.removeListener(t,a.fn,!0),u){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,n),!0;case 4:return a.fn.call(a.context,e,n,r),!0;case 5:return a.fn.call(a.context,e,n,r,o),!0;case 6:return a.fn.call(a.context,e,n,r,o,i),!0}for(c=1,s=new Array(u-1);u>c;c++)s[c-1]=arguments[c];a.fn.apply(a.context,s)}else{var p,f=a.length;for(c=0;f>c;c++)switch(a[c].once&&this.removeListener(t,a[c].fn,!0),u){case 1:a[c].fn.call(a[c].context);break;case 2:a[c].fn.call(a[c].context,e);break;case 3:a[c].fn.call(a[c].context,e,n);break;default:if(!s)for(p=1,s=new Array(u-1);u>p;p++)s[p-1]=arguments[p];a[c].fn.apply(a[c].context,s)}}return!0},o.prototype.on=function(t,e,n){var o=new r(e,n||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],o]:this._events[t].push(o):this._events[t]=o,this},o.prototype.once=function(t,e,n){var o=new r(e,n||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],o]:this._events[t].push(o):this._events[t]=o,this},o.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],o=[];if(e&&(r.fn&&(r.fn!==e||n&&!r.once)&&o.push(r),!r.fn))for(var i=0,s=r.length;s>i;i++)(r[i].fn!==e||n&&!r[i].once)&&o.push(r[i]);return o.length?this._events[t]=1===o.length?o[0]:o:delete this._events[t],this},o.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.EventEmitter=o,o.EventEmitter2=o,o.EventEmitter3=o,e.exports=o},{}],4:[function(t,e,n){"use strict";function r(t){for(var e,n=/([^=?&]+)=([^&]*)/g,r={};e=n.exec(t);r[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return r}function o(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var r in t)i.call(t,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e+n.join("&")}var i=Object.prototype.hasOwnProperty;n.stringify=o,n.parse=r},{}],5:[function(t,e,n){"use strict";function r(t,e,n){return s(t in n?n[t]:t in e?e[t]:o[t])}function o(t){var e=this;return e instanceof o?(t=t||{},e.attempt=null,e._fn=null,e["reconnect timeout"]=r("reconnect timeout",e,t),e.retries=r("retries",e,t),e.factor=r("factor",e,t),e.max=r("max",e,t),e.min=r("min",e,t),void(e.timers=new a(e))):new o(t)}var i=t("eventemitter3"),s=t("millisecond"),c=t("demolish"),a=t("tick-tock"),u=t("one-time");o.prototype=new i,o.prototype.constructor=o,o["reconnect timeout"]="30 seconds",o.max=1/0,o.min="500 ms",o.retries=10,o.factor=2,o.prototype.reconnect=function(){var t=this;return t.backoff(function(e,n){return n.duration=+new Date-n.start,e?t.emit("reconnect failed",e,n):void t.emit("reconnected",n)},t.attempt)},o.prototype.backoff=function(t,e){var n=this;return e=e||n.attempt||{},e.backoff?n:(e["reconnect timeout"]=r("reconnect timeout",n,e),e.retries=r("retries",n,e),e.factor=r("factor",n,e),e.max=r("max",n,e),e.min=r("min",n,e),e.start=+e.start||+new Date,e.duration=+e.duration||0,e.attempt=+e.attempt||0,e.attempt===e.retries?(t.call(n,new Error("Unable to recover"),e),n):(e.backoff=!0,e.attempt++,n.attempt=e,e.scheduled=1!==e.attempt?Math.min(Math.round((Math.random()+1)*e.min*Math.pow(e.factor,e.attempt-1)),e.max):e.min,n.timers.setTimeout("reconnect",function(){e.duration=+new Date-e.start,e.backoff=!1,n.timers.clear("reconnect, timeout");var r=n._fn=u(function(r){return n.reset(),r?n.backoff(t,e):void t.call(n,void 0,e)});n.emit("reconnect",e,r),n.timers.setTimeout("timeout",function(){var t=new Error("Failed to reconnect in a timely manner");e.duration=+new Date-e.start,n.emit("reconnect timeout",t,e),r(t)},e["reconnect timeout"])},e.scheduled),n.emit("reconnect scheduled",e),n))},o.prototype.reconnecting=function(){return!!this.attempt},o.prototype.reconnected=function(t){return this._fn&&this._fn(t),this},o.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},o.prototype.destroy=c("timers attempt _fn"),e.exports=o},{demolish:1,eventemitter3:3,millisecond:6,"one-time":7,"tick-tock":8}],6:[function(t,e,n){e.exports=function(t){"use strict";if("string"!=typeof t||"0"===t||+t)return+t;var e,n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t),r=1e3,o=60*r,i=60*o,s=24*i;if(!n)return 0;switch(e=parseFloat(n[1]),n[2].toLowerCase()){case"days":case"day":case"d":return e*s;case"hours":case"hour":case"hrs":case"hr":case"h":return e*i;case"minutes":case"minute":case"mins":case"min":case"m":return e*o;case"seconds":case"second":case"secs":case"sec":case"s":return e*r;default:return e}}},{}],7:[function(t,e,n){"use strict";e.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}},{}],8:[function(t,e,n){"use strict";function r(t){return this instanceof r?(this.timers={},void(this.context=t||this)):new r(t)}var o=Object.prototype.hasOwnProperty,i=t("millisecond");r.prototype.tock=function(t,e){var n=this;return function(){if(t in n.timers){var r=n.timers[t],o=r.fns.slice(),i=o.length,s=0;for(e&&n.clear(t);i>s;s++)o[s].call(n.context)}}},r.prototype.setTimeout=function(t,e,n){var r=this;return r.timers[t]?(r.timers[t].fns.push(e),r):(r.timers[t]={timer:setTimeout(r.tock(t,!0),i(n)),clear:function(t){clearTimeout(t)},fns:[e]},r)},r.prototype.setInterval=function(t,e,n){var r=this;return r.timers[t]?(r.timers[t].fns.push(e),r):(r.timers[t]={timer:setInterval(r.tock(t),i(n)),clear:function(t){clearInterval(t)},fns:[e]},r)},r.prototype.setImmediate=function(t,e){var n=this;return"function"!=typeof setImmediate?n.setTimeout(t,e,0):n.timers[t]?(n.timers[t].fns.push(e),n):(n.timers[t]={timer:setImmediate(n.tock(t,!0)),clear:function(t){clearImmediate(t)},fns:[e]},n)},r.prototype.active=function(t){return t in this.timers},r.prototype.clear=function(){var t,e,n,r=arguments.length?arguments:[],i=this;if(1===r.length&&"string"==typeof r[0]&&(r=r[0].split(/[, ]+/)),!r.length)for(t in i.timers)o.call(i.timers,t)&&r.push(t);for(e=0,n=r.length;n>e;e++)t=i.timers[r[e]],t&&(t.clear(t.timer),t.fns=t.timer=t.clear=null,delete i.timers[r[e]]);return i},r.prototype.end=r.prototype.destroy=function(){return this.context?(this.clear(),this.context=this.timers=null,!0):!1},r.prototype.adjust=function(t,e){var n,r=this,o=r.timers[t];return o?(n=o.clear===clearInterval,o.clear(o.timer),o.timer=(n?setInterval:setTimeout)(r.tock(t,!n),i(e)),r):r},e.exports=r},{millisecond:9}],9:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],10:[function(e,n,r){"use strict";function o(t,e){if(!(t instanceof i)){var n=new Error("Primus#"+e+"'s context should called with a Primus instance");if("function"!=typeof t.listeners||!t.listeners("error").length)throw n;t.emit("error",n)}}function i(t,e){if(!(this instanceof i))return new i(t,e);if("function"!=typeof this.client){var n="The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details";return this.critical(new Error(n))}"object"==typeof t?(e=t,t=e.url||e.uri||s):e=e||{};var r=this;e.queueSize="queueSize"in e?e.queueSize:1/0,e.timeout="timeout"in e?e.timeout:1e4,e.reconnect="reconnect"in e?e.reconnect:{},e.ping="ping"in e?e.ping:25e3,e.pong="pong"in e?e.pong:1e4,e.strategy="strategy"in e?e.strategy:[],e.transport="transport"in e?e.transport:{},r.buffer=[],r.writable=!0,r.readable=!0,r.url=r.parse(t||s),r.readyState=i.CLOSED,r.options=e,r.timers=new a(this),r.socket=null,r.latency=0,r.stamps=0,r.disconnect=!1,r.transport=e.transport,r.transformers={outgoing:[],incoming:[]},r.recovery=new u(e.reconnect),"string"==typeof e.strategy&&(e.strategy=e.strategy.split(/\s?\,\s?/g)),!1===e.strategy?e.strategy=[]:e.strategy.length||(e.strategy.push("disconnect","online"),this.authorization||e.strategy.push("timeout")),e.strategy=e.strategy.join(",").toLowerCase(),"websockets"in e&&(r.AVOID_WEBSOCKETS=!e.websockets),"network"in e&&(r.NETWORK_EVENTS=e.network),e.manual||r.timers.setTimeout("open",function(){r.timers.clear("open"),r.open()},0),r.initialise(e)}var s,c=e("eventemitter3"),a=e("tick-tock"),u=e("recovery"),p=e("querystringify"),f=e("demolish");try{s=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch(l){s="http://127.0.0.1"}i.require=function(n){return"function"!=typeof e?void 0:"function"==typeof t&&t.amd?void 0:e(n)};var m,h;try{i.Stream=m=i.require("stream"),h=i.require("url").parse,i.require("util").inherits(i,m)}catch(l){i.Stream=c,i.prototype=new c,h=function(t){var e,n=document.createElement("a"),r={};n.href=t;for(e in n)("string"==typeof n[e]||"number"==typeof n[e])&&(r[e]=n[e]);if(r.href=encodeURI(decodeURI(r.href)),!r.port){var o=(r.href||"").split("/");if(o.length>2){var i=o[2],s=i.lastIndexOf("@");~s&&(i=i.slice(s+1)),o=i.split(":"),2===o.length&&(r.port=o[1])}}if(r.protocol&&":"!==r.protocol||(r.protocol=r.href.substr(0,r.href.indexOf(":")+1)),"0"===r.port&&(r.port=""),~r.href.indexOf("@")&&!r.auth){var c=r.protocol.length+2;r.auth=r.href.slice(c,r.href.indexOf(r.pathname,c)).split("@")[0]}return r}}i.OPENING=1,i.CLOSED=2,i.OPEN=3,i.prototype.AVOID_WEBSOCKETS=!1,i.prototype.NETWORK_EVENTS=!1,i.prototype.online=!0;try{(i.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(i.prototype.online=!1))}catch(l){}if(i.prototype.ark={},i.prototype.emits=e("emits"),i.prototype.trigger=function(){for(var t=0,e=arguments.length,n=new Array(e);e>t;t++)n[t]=arguments[t];return"function"!=typeof n[e-1]&&n.push(function(t){setTimeout(t,0)}),this.emits.apply(this,n)},i.prototype.plugin=function(t){if(o(this,"plugin"),t)return this.ark[t];var e={};for(t in this.ark)e[t]=this.ark[t];return e},i.prototype.reserved=function(t){return/^(incoming|outgoing)::/.test(t)||t in this.reserved.events},i.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,online:1,error:1,close:1,open:1,data:1,end:1},i.prototype.initialise=function(t){function e(){o.online&&(o.online=!1,o.emit("offline"),o.end(),o.recovery.reset())}function n(){o.online||(o.online=!0,o.emit("online"),~o.options.strategy.indexOf("online")&&o.recovery.reconnect())}var r,o=this;o.recovery.on("reconnected",o.emits("reconnected")).on("reconnect failed",o.emits("reconnect failed",function(t){return o.emit("end"),t})).on("reconnect timeout",o.emits("reconnect timeout")).on("reconnect scheduled",o.emits("reconnect scheduled")).on("reconnect",o.emits("reconnect",function(t){o.emit("outgoing::reconnect"),t()})),o.on("outgoing::open",function(){var t=o.readyState;o.readyState=i.OPENING,t!==o.readyState&&o.emit("readyStateChange","opening"),r=+new Date}),o.on("incoming::open",function(){var t=o.readyState;if(o.recovery.reconnecting()&&o.recovery.reconnected(),o.writable=!0,o.readable=!0,o.online||(o.online=!0,o.emit("online")),o.readyState=i.OPEN,t!==o.readyState&&o.emit("readyStateChange","open"),o.latency=+new Date-r,o.timers.clear("ping","pong"),o.heartbeat(),o.buffer.length){var e=o.buffer.slice(),n=e.length,s=0;for(o.buffer.length=0;n>s;s++)o._write(e[s])}o.emit("open")}),o.on("incoming::pong",function(t){o.online=!0,o.timers.clear("pong"),o.heartbeat(),o.latency=+new Date-t}),o.on("incoming::error",function(t){var e=o.timers.active("connect"),n=t;if("string"==typeof t)n=new Error(t);else if(!(t instanceof Error)&&"object"==typeof t){n=new Error(t.message||t.reason);for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return o.recovery.reconnecting()?o.recovery.reconnected(n):(o.listeners("error").length&&o.emit("error",n),void(e&&(~o.options.strategy.indexOf("timeout")?o.recovery.reconnect():o.end())))}),o.on("incoming::data",function(t){o.decoder(t,function(e,n){return e?o.listeners("error").length&&o.emit("error",e):void(o.protocol(n)||o.transforms(o,o,"incoming",n,t))})}),o.on("incoming::end",function(){var t=o.readyState;return o.disconnect?(o.disconnect=!1,o.end()):(o.readyState=i.CLOSED,t!==o.readyState&&o.emit("readyStateChange","end"),o.timers.active("connect")&&o.end(),t!==i.OPEN?o.recovery.reconnecting()?o.recovery.reconnect():!1:(this.writable=!1,this.readable=!1,this.timers.clear(),o.emit("close"),~o.options.strategy.indexOf("disconnect")?o.recovery.reconnect():(o.emit("outgoing::end"),void o.emit("end"))))}),o.client();for(var s in o.ark)o.ark[s].call(o,o,t);return o.NETWORK_EVENTS?(window.addEventListener?(window.addEventListener("offline",e,!1),window.addEventListener("online",n,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",e),document.body.attachEvent("ononline",n)),o):o},i.prototype.protocol=function(t){if("string"!=typeof t||0!==t.indexOf("primus::"))return!1;var e=t.indexOf(":",8),n=t.slice(e+2);switch(t.slice(8,e)){case"pong":this.emit("incoming::pong",n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},i.prototype.transforms=function(t,e,n,r,o){var i={data:r},s=t.transformers[n];return function c(t,n){var r=s[t++];if(!r)return n();if(1===r.length){if(!1===r.call(e,i))return;return c(t,n)}r.call(e,i,function(r,o){return r?e.emit("error",r):void(!1!==o&&c(t,n))})}(0,function(){return"incoming"===n?e.emit("data",i.data,o):void e._write(i.data)}),this},i.prototype.id=function(t){return this.socket&&this.socket.id?t(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",t))},i.prototype.open=function(){return o(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},i.prototype.write=function(t){return o(this,"write"),this.transforms(this,this,"outgoing",t),!0},i.prototype._write=function(t){var e=this;return i.OPEN!==e.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(t),!1):(e.encoder(t,function(t,n){return t?e.listeners("error").length&&e.emit("error",t):void e.emit("outgoing::data",n)}),!0)},i.prototype.heartbeat=function(){function t(){n.timers.clear("pong"),n.online&&(n.online=!1,n.emit("offline"),n.emit("incoming::end"))}function e(){var e=+new Date;n.timers.clear("ping"),n._write("primus::ping::"+e),n.emit("outgoing::ping",e),n.timers.setTimeout("pong",t,n.options.pong)}var n=this;return n.options.ping?(n.timers.setTimeout("ping",e,n.options.ping),this):n},i.prototype.timeout=function(){function t(){e.removeListener("error",t).removeListener("open",t).removeListener("end",t).timers.clear("connect")}var e=this;return e.timers.setTimeout("connect",function(){t(),e.readyState===i.OPEN||e.recovery.reconnecting()||(e.emit("timeout"),~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())},e.options.timeout),e.on("error",t).on("open",t).on("end",t)},i.prototype.end=function(t){if(o(this,"end"),this.readyState===i.CLOSED&&!this.timers.active("connect"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==t&&this.write(t),this.writable=!1,this.readable=!1;var e=this.readyState;return this.readyState=i.CLOSED,e!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},i.prototype.destroy=f("url timers options recovery socket transport transformers",{before:"end",after:"removeAllListeners"}),i.prototype.clone=function(t){return this.merge({},t)},i.prototype.merge=function(t){for(var e,n,r=Array.prototype.slice.call(arguments,1),o=0,i=r.length;i>o;o++){n=r[o];for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t},i.prototype.parse=h,i.prototype.querystring=p.parse,i.prototype.querystringify=p.stringify,i.prototype.uri=function(t){var e=this.url,n=[],r=!1;t.query&&(r=!0),t=t||{},t.protocol="protocol"in t?t.protocol:"http",t.query=e.search&&"query"in t?"?"===e.search.charAt(0)?e.search.slice(1):e.search:!1,t.secure="secure"in t?t.secure:"https:"===e.protocol||"wss:"===e.protocol,t.auth="auth"in t?t.auth:e.auth,t.pathname="pathname"in t?t.pathname:this.pathname.slice(1),t.port="port"in t?+t.port:+e.port||(t.secure?443:80),t.host="host"in t?t.host:e.hostname||e.host.replace(":"+e.port,""),this.emit("outgoing::url",t);var o=443!==t.port&&80!==t.port?t.host+":"+t.port:t.host,i=this.querystring(t.query||"");return i._primuscb=+new Date+"-"+this.stamps++,t.query=this.querystringify(i),n.push(t.secure?t.protocol+"s:":t.protocol+":",""),n.push(t.auth?t.auth+"@"+o:o),t.pathname&&n.push(t.pathname),r?n.push("?"+t.query):delete t.query,t.object?t:n.join("/")},i.prototype.transform=function(t,e){return o(this,"transform"),t in this.transformers?(this.transformers[t].push(e),this):this.critical(new Error("Invalid transformer type"))},i.prototype.critical=function(t){if(this.listeners("error").length)return this.emit("error",t),this;throw t},i.connect=function(t,e){return new i(t,e)},i.EventEmitter=c,i.prototype.client=function(){var t,e=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return i.require("ws")}catch(t){}return void 0}();return n?(e.on("outgoing::open",function(){e.emit("outgoing::end");try{var r="ws+unix:"===e.url.protocol?"ws+unix":"ws",o="ws"===r;e.socket=t=3===n.length?new n(e.uri({protocol:r,query:o}),[],e.transport):new n(e.uri({protocol:r,query:o}))}catch(i){return e.emit("error",i)}t.binaryType="arraybuffer",t.onopen=e.trigger("incoming::open"),t.onerror=e.trigger("incoming::error"),t.onclose=e.trigger("incoming::end"),t.onmessage=e.trigger("incoming::data",function(t,e){setTimeout(function(){t(void 0,e.data)},0)})}),e.on("outgoing::data",function(r){if(t&&t.readyState===n.OPEN)try{t.send(r)}catch(o){e.emit("incoming::error",o)}}),e.on("outgoing::reconnect",function(){e.emit("outgoing::open")}),void e.on("outgoing::end",function(){t&&(t.onerror=t.onopen=t.onclose=t.onmessage=function(){},t.close(),t=null)})):e.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"))},i.prototype.authorization=!1,i.prototype.pathname="/primus",i.prototype.encoder=function(t,e){var n;try{t=JSON.stringify(t)}catch(r){n=r}e(n,t)},i.prototype.decoder=function(t,e){var n;if("string"!=typeof t)return e(n,t);try{t=JSON.parse(t)}catch(r){n=r}e(n,t)},i.prototype.version="3.0.2","object"==typeof JSON&&"function"==typeof JSON.stringify&&'["\u2028\u2029"]'===JSON.stringify(["\u2028\u2029"])&&(JSON.stringify=function(t){var e=/\u2028/g,n=/\u2029/g;return function(r,o,i){var s=t.call(this,r,o,i);return s&&(~s.indexOf("\u2028")&&(s=s.replace(e,"\\u2028")),~s.indexOf("\u2029")&&(s=s.replace(n,"\\u2029"))),s}}(JSON.stringify)),"undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault&&t.preventDefault()},!1);var d=(navigator.userAgent||"").toLowerCase(),y=d.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],g=+[y[1],y[2]].join(".");!~d.indexOf("chrome")&&~d.indexOf("safari")&&534.54>g&&(i.prototype.AVOID_WEBSOCKETS=!0)}n.exports=i},{demolish:1,emits:2,eventemitter3:3,querystringify:4,recovery:5,"tick-tock":8}]},{},[10])(10);return e}),function(t){var e=function(t,e){var n=this;n.callbacks={},n.id=null,n.events={},n.rooms=[],n.state="disconnected",n.options=n.defaults();for(var r in t)n.options[r]=t[r];e&&(n.client=e)};if("undefined"==typeof Primus){var n=require("util"),r=require("events").EventEmitter;n.inherits(e,r)}else e.prototype=new Primus.EventEmitter;e.prototype.defaults=function(){return{apiPath:"/api",url:window.location.origin}},e.prototype.connect=function(t){var e=this;e.messageCount=0,e.client?(e.client.end(),e.client.open()):e.client=Primus.connect(e.options.url,e.options),e.client.on("open",function(){e.configure(function(n){e.emit("connected"),"connected"===e.state||(e.state="connected","function"==typeof t&&t(null,n))})}),e.client.on("error",function(t){e.emit("error",t)}),e.client.on("reconnect",function(){e.messageCount=0,e.emit("reconnect")}),e.client.on("reconnecting",function(){e.emit("reconnecting"),e.state="reconnecting",e.emit("disconnected")}),e.client.on("end",function(){e.messageCount=0,"disconnected"!==e.state&&(e.state="disconnected",e.emit("disconnected"))}),e.client.on("data",function(t){e.handleMessage(t)})},e.prototype.configure=function(t){var e=this;e.rooms.forEach(function(t){e.send({event:"roomAdd",room:t})}),e.detailsView(function(n){e.id=n.data.id,e.fingerprint=n.data.fingerprint,e.rooms=n.data.rooms,t(n)})},e.prototype.send=function(t,e){var n=this;n.messageCount++,"function"==typeof e&&(n.callbacks[n.messageCount]=e),n.client.write(t)},e.prototype.handleMessage=function(t){var e=this;e.emit("message",t),"response"===t.context?("function"==typeof e.callbacks[t.messageCount]&&e.callbacks[t.messageCount](t),delete e.callbacks[t.messageCount]):"user"===t.context?e.emit("say",t):"alert"===t.context?e.emit("alert",t):t.welcome&&"api"===t.context?(e.welcomeMessage=t.welcome,e.emit("welcome",t)):"api"===t.context&&e.emit("api",t)},e.prototype.action=function(t,e,n){n||"function"!=typeof e||(n=e,e=null),e||(e={}),e.action=t,"connected"!==this.state?this.actionWeb(e,n):this.actionWebSocket(e,n)},e.prototype.actionWeb=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var t=JSON.parse(n.responseText);e(null,t)}else e(n.statusText,n.responseText)};var r=t.httpMethod||"POST",o=this.options.url+this.options.apiPath+"?action="+t.action;n.open(r,o,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))},e.prototype.actionWebSocket=function(t,e){this.send({event:"action",params:t},e)},e.prototype.say=function(t,e,n){this.send({event:"say",room:t,message:e},n)},e.prototype.file=function(t,e){this.send({event:"file",file:t},e)},e.prototype.detailsView=function(t){this.send({event:"detailsView"},t)},e.prototype.roomView=function(t,e){this.send({event:"roomView",room:t},e)},e.prototype.roomAdd=function(t,e){var n=this;n.send({event:"roomAdd",room:t},function(t){n.configure(function(n){"function"==typeof e&&e(t)})})},e.prototype.roomLeave=function(t,e){var n=this,r=n.rooms.indexOf(t);r>-1&&n.rooms.splice(r,1),this.send({event:"roomLeave",room:t},function(t){n.configure(function(n){"function"==typeof e&&e(t)})})},e.prototype.documentation=function(t){this.send({event:"documentation"},t)},e.prototype.disconnect=function(){this.state="disconnected",this.client.end(),this.emit("disconnected")};var o=e;t.ActionheroClient=e,t.actionheroClient=o}("undefined"==typeof exports?window:exports);